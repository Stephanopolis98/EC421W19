<!DOCTYPE html>
<html>
  <head>
    <title>Instrumental Variables</title>
    <meta charset="utf-8">
    <meta name="author" content="Edward Rubin" />
    <meta name="date" content="2019-03-05" />
    <link href="11_instrumental_variables_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="11_instrumental_variables_files/remark-css-0.0.1/metropolis.css" rel="stylesheet" />
    <link href="11_instrumental_variables_files/remark-css-0.0.1/metropolis-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="my-css.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Instrumental Variables
## EC 421, Set 11
### Edward Rubin
### 05 March 2019

---

class: inverse, middle



# Prologue

---
name: schedule

# Schedule

## Last Time

Causality

## Today

- Econ. Masters program
- Review: Causality
- New: Instrumental variables

## Upcoming

Assignment soon.
---
layout: false
name: masters

# Master's Program
## Applied Economics

You could be a master of (applied) economics...

- 1-year program including courses on applied econometrics, data science, and "big data".
- Awesome opportunity to focus on applying economic methods to real-world questions/scenarios.
- [Applications are due by **May 1 (2019)**](https://economics.uoregon.edu/masters/).

More information: [https://economics.uoregon.edu/masters/](https://economics.uoregon.edu/masters/)

---
layout: false
class: inverse, middle
# Causality
## Review
---
layout: true
# Causality
## Review
---
name: causality_review

In our last lecture, we returned to the concept of .hi[causality].

--

We worked through the *Rubin causal model*, in which we defined

- `\(\color{#e64173}{y_{1i}:}\)` the outcome for individual `\(i\)` if she had received treatment

--
- `\(\color{#6A5ACD}{y_{0i}:}\)` the outcome for individual `\(i\)` if she had not received treatment

--

and we referred to individuals who did not receive treatment as *control*.

--

***If*** we were able to know both `\(\color{#e64173}{y_{1i}}\)` ***and*** `\(\color{#6A5ACD}{y_{0i}}\)`, we could calculate the causal effect of treatment for individual `\(i\)`, _i.e._,

--

$$
`\begin{align}
  \tau_i = \color{#e64173}{y_{1i}} - \color{#6A5ACD}{y_{0i}}
\end{align}`
$$

---

.hi-slate[Fundamental problem of causal inference:]
&lt;br&gt;We cannot simultaneously know `\(\color{#e64173}{y_{1i}}\)` and `\(\color{#6A5ACD}{y_{0i}}\)`.

--

Either we observe individual `\(i\)` in the treatment group, _i.e._,
$$
`\begin{align}
  \tau_i = \color{#e64173}{y_{1i}} - \color{#6A5ACD}{?}
\end{align}`
$$

--

or we observe `\(i\)` in the control group, _i.e._,
$$
`\begin{align}
  \tau_i = \color{#e64173}{?} - \color{#6A5ACD}{y_{0i}}
\end{align}`
$$

--

but never both at the same time.
---

If we want to know `\(\tau_i\)` (or at least `\(\overline{\tau}\)`), what can we do?

--

**Idea:** Estimate the .hi-slate[average treatment effect] as the difference between the average outcomes in the treatment group and the control group, _i.e._,

$$
`\begin{align}
  \color{#e64173}{\mathop{Avg}\left( y_i\mid D_i = 1 \right)} - \color{#6A5ACD}{\mathop{Avg}\left( y_i\mid D_i =0 \right)}
\end{align}`
$$
where `\(D_i=1\)` if `\(i\)` received treatment, and `\(D_i=0\)` if `\(i\)` is in the control group.

---

**Result:** We showed that even when the treatment effect is constant (meaning `\(\tau_i=\tau\)` for all `\(i\)`),
$$
`\begin{align}
  &amp;\color{#e64173}{\mathop{Avg}\left( y_i\mid D_i = 1 \right)} - \color{#6A5ACD}{\mathop{Avg}\left( y_i\mid D_i =0 \right)} \\
  &amp;\quad\quad = \tau + \underbrace{\color{#e64173}{\mathop{Avg}\left(\color{#6A5ACD}{y_{0,i}} \mid D_i = 1 \right)} - \color{#6A5ACD}{\mathop{Avg}\left( y_{0,i}\mid D_i =0 \right)}}_{\color{#FFA500}{\text{Selection bias}}}
\end{align}`
$$

which says that the difference in the groups' means will give us a **biased estimate** for the causal effect of treatment .hi-orange[if we have selection bias.]
---

**Q:** What is this .hi-orange[selection bias]?

--

**A:** **(Informal)** We have selection bias when our control group doesn't offer a good comparison for our treatment group.

--

Specifically, the control group doesn't give us a good .hi-orange[counterfactual] for .orange[what our treatment group would have looked like if the members had not received treatment.]
--
 Basically, the groups are different.

--

**A:** **(Formal)** The .pink[average *untreated* outcome for a member of our **treatment group**] (which we cannot observe) differs from the .purple[average *untreated* outcome for a member of our **control group**], _i.e._,
$$
`\begin{align}
  \color{#e64173}{\mathop{Avg}\left(\color{#6A5ACD}{y_{0,i}} \mid D_i = 1 \right)} - \color{#6A5ACD}{\mathop{Avg}\left( y_{0,i}\mid D_i =0 \right)}
\end{align}`
$$
---

.hi-slate[Practical problem:] Selection bias is also difficult to observe

$$
`\begin{align}
  \underbrace{\color{#e64173}{\mathop{Avg}\left(\color{#6A5ACD}{y_{0,i}} \mid D_i = 1 \right)}}_{\color{#e64173}{\text{Unobservable}}} - \color{#6A5ACD}{\mathop{Avg}\left( y_{0,i}\mid D_i =0 \right)}
\end{align}`
$$

(back to the *fundamental problem of causal inference*)

--

.hi-slate[Bigger problem:] If selection bias is present, our estimate for `\(\tau\)` is biased, preventing us from understanding the causal effect of treatment.

--

Sounds a bit like omitted-variable bias, right?
--
 Our .pink[treatment] variable is correlated with something that makese the two groups different.
---

**Example:** Imagine we have two people—Al and Bri—and a single binary treatment, college. We interested in the effect of college on earnings.

.pull-left[.center[
.pink[Earn.sub[1,Al]] = .pink[$60K]
&lt;br&gt;.purple[Earn.sub[0,Al]] = .purple[$30K]
]]
.pull-right[
.pink[Earn.sub[1,Bri]] = .pink[$140K]
&lt;br&gt;.purple[Earn.sub[0,Bri]] = .purple[$110K]
]

--

They both have the same treatment effect (return to college)
--
&lt;br&gt; `\(\quad\quad\tau\)`.sub[Al] = .pink[Earn.sub[1,Al]] - .purple[Earn.sub[0,Al]] = .pink[$60K] - .purple[$30K] = $30K
--
&lt;br&gt; `\(\quad\quad\tau\)`.sub[Bri] = .pink[Earn.sub[1,Bri]] - .purple[Earn.sub[0,Bri]] = .pink[$140K] - .purple[$100K] = $30K

--

but any real-world estimate would have serious selection issues since .purple[Earn.sub[0,Al]] ≠ .purple[Earn.sub[0,Bri].]
---
count: false

**Example:** Imagine we have two people—Al and Bri—and a single binary treatment, college. We interested in the effect of college on earnings.

.pull-left[.center[
.pink[Earn.sub[1,Al]] = .pink[$60K]
&lt;br&gt;.purple[Earn.sub[0,Al]] = .purple[$30K]
]]
.pull-right[
.pink[Earn.sub[1,Bri]] = .pink[$140K]
&lt;br&gt;.purple[Earn.sub[0,Bri]] = .purple[$110K]
]

The selection bias...

--

If Bri attended college (D.sub[Bri]=1) and Al did not (D.sub[Al]=0):
&lt;br&gt;
`\(\quad\quad\hat{\tau}\)` = .pink[Earn.sub[1,Bri]] - .purple[Earn.sub[0,Al]] = .pink[$140K] - .purple[$30K] = $110K

--

If Al attended college (D.sub[Al]=1) and Bri did not (D.sub[Bri]=0):
&lt;br&gt;
`\(\quad\quad\hat{\tau}\)` = .pink[Earn.sub[1,Al]] - .purple[Earn.sub[0,Bri]] = .pink[$60K] - .purple[$110K] = -$50K



---

We have (at least) two problems...

1. Selection bias is difficult to observe

2. If selection bias is present, our estimate for `\(\tau\)` is biased, preventing us from understanding the causal effect of treatment.

--

.hi-slate[Solution:] Eliminate/minimize selection bias.

--

- .hi-slate[Option 1:] .hi-pink[Distribute treatment] in a way such that the treatment and control groups are essentially identical
--
 (experiments).

--

- .hi-slate[Option 2:] .hi-purple[Build a control] group that *matches* the treatment group
--
 &lt;br&gt;(life with observational data).
---
layout: true
# Instrumental variables
---
class: inverse, middle
---
name: intro

## Intro

.hi[Instrumental variables (IV)] is one route econometricians often take toward estimating the causal effect of a treatment/program.

--

*Recall:* .hi-orange[Selection bias] means our .pink[treatment] and .purple[control] groups differ on some unobserved/omitted dimension. (.hi-slate[Endogeneity])

--

.hi-pink[Instrumental variables] attempts to separate out

- the .hi-slate[exogenous] part of `\(x\)`, which gives us unbiased estimates
- the .hi-slate[endogenous] part of `\(x\)`, which biases our results

--

If we use only the exogenous (*good*) variation in `\(x\)`, then we can avoid selection bias/omitted-variable bias.
---

## Introductory example

*Example:* If we want to estimate the effect of veteran status on earnings,
$$
`\begin{align}
  \text{Earnings}_i = \beta_0 + \beta_1 \text{Veteran}_i + u_i \tag{1}
\end{align}`
$$

--

We would love to calculate `\(\color{#e64173}{\text{Earnings}_{1i}} - \color{#6A5ACD}{\text{Earnings}_{0i}}\)`, but we can't.

--

And OLS will likely be biased for `\((1)\)` due to selection/omitted-variable bias.

---

## Introductory example

Imagine that we can split veteran status into an exogenous part and an endogenous part...

--

$$
`\begin{align}
  \text{Earnings}_i
  &amp;= \beta_0 + \beta_1 \left(\text{Veteran}_i^{\text{Exog.}} + \text{Veteran}_i^{\text{Endog.}}\right) + u_i \\
  &amp;= \beta_0 + \beta_1 \text{Veteran}_i^{\text{Exog.}} + \underbrace{\beta_1 \text{Veteran}_i^{\text{Endog.}} + u_i}_{w_i} \\
  &amp;= \beta_0 + \beta_1 \text{Veteran}_i^{\text{Exog.}} + w_i
\end{align}`
$$

--

We could use this exogenous variation in veteran status to consistently estimate `\(\beta_1\)`.

--

**Q:** What would exogenous variation in veteran status mean?
---

## Introductory example

**Q:** What would exogenous variation in veteran status mean?

--

**A.sub[1]:** Choices to enlist in the military that are essentially random—or at least uncorrelated with omitted variables and the disturbance.

--

**A.sub[2]:** .hi-orange[No selection bias:]
$$
`\begin{align}
  \color{#e64173}{\mathop{Avg}\left(\text{Earnings}_{0i}\mid\text{Veteran}_i = 1\right)} - \color{#6A5ACD}{\mathop{Avg}\left( \text{Earnings}_{0i} \mid \text{Veteran}_i = 0 \right)} = 0
\end{align}`
$$

---
name: instruments

## Instruments

**Q:** How do we isolate this *exogenous variation* in our explanatory variable?
--
&lt;br&gt;**A:** Find an instrument (an instrumental variable).

--

**Q:** What's an instrument?
--
&lt;br&gt;**A:** An .hi-pink[instrument] is a variable that is

1. **correlated** with the **explanatory variable** of interest (.hi[relevant]),
2. **uncorrelated** with the **disturbance** (.hi[exogenous]).

---

## Instruments

&gt;**Q:** What's an instrument?
&gt;&lt;br&gt;**A:** An .hi-pink[instrument] is a variable that is
&gt;
&gt;1. **correlated** with the **explanatory variable** of interest (.hi[relevant]),
&gt;2. **uncorrelated** with the **disturbance** (.hi[exogenous]).

--

So if we want an instrument `\(z_i\)` for endogenous veteran status in
$$
`\begin{align}
  \text{Earnings}_i = \beta_0 + \beta_1 \text{Veteran}_i + u_i
\end{align}`
$$

1. .hi[Relevant:] `\(\mathop{\text{Cov}} \left( \text{Veteran}_i,\, z_i \right) \neq 0\)`
2. .hi[Exogenous:] `\(\mathop{\text{Cov}} \left( z_i,\, u_i \right) = 0\)`
---
name: relevant

## Instruments: Relevance

.hi[Relevance:] We need the instrument to cause a change in (correlate with) our endogenous explanatory variable.

We can actually test this requirement using regression and a *t* test.

--

***Example:*** For the .pink[veteran status], consider three potential instruments:

.pull-left[1\. Social security number&lt;br&gt;.white[blank]]

--

.pull-right[.hi-slate[Probably not relevant]&lt;br&gt;uncorrelated with military service]

--

.pull-left[2\. Physical fitness&lt;br&gt;.white[blank]]

--

.pull-right[.hi-pink[Potentially relevant]&lt;br&gt;service may correlate with fitness]

--

.pull-left[3\. Vietnam War draft]

--

.pull-right[.hi-pink[Relevant]&lt;br&gt;being draw led to service]

---
name: exogenous

## Instruments: Exogeneity

.hi[Exogeneity:] The instrument to be independent of omitted factors that affect our outcome variable—as good as randomly assigned.

`\(z_i\)` must be uncorrelated with our disturbance `\(u_i\)`. .hi[Not testable.]

--

***Example:*** For the .pink[veteran status], consider three potential instruments:

.pull-left[1\. Social security number&lt;br&gt;.white[blank]]

--

.pull-right[.hi-pink[Exogenous]&lt;br&gt;Indep. of other factors of service]

--

.pull-left[2\. Physical fitness&lt;br&gt;.white[blank]]

--

.pull-right[.hi-slate[Not exogenous]&lt;br&gt;fitness correlates with many things]

--

.pull-left[3\. Vietnam War draft]

--

.pull-right[.hi-pink[Exogenous]&lt;br&gt;the lottery was random]

---

## Instrumental review

Let's recap...

- Our instrument must be .hi[correlated with our endogenous variable].

- Our instrument must be .hi[uncorrelated with any other variable that affects the outcome].

--

.hi-slate[In other words:]
&lt;br&gt;The instrument only affects our outcome through the endogenous variable.
---

## Back to our example

For .pink[veteran status] we considered three potential instruments:

--

.pull-left[1\. Social security number&lt;br&gt;.white[blank]&lt;br&gt;.white[blank]]

.pull-right[.hi-slate[Not relevant]&lt;br&gt;.hi-pink[Exogenous]&lt;br&gt;.white[blank]]

--

.pull-left[2\. Physical fitness&lt;br&gt;.white[blank]&lt;br&gt;.white[blank]]

.pull-right[.hi-pink[Probably relevant]&lt;br&gt;.hi-slate[Not exogenous]&lt;br&gt;.white[blank]]

--

.pull-left[3\. Vietnam War draft&lt;br&gt;.white[blank]&lt;br&gt;.white[blank]]

.pull-right[.hi-pink[Relevant]&lt;br&gt;.hi-pink[Exogenous]&lt;br&gt;.white[blank]]

--

Thus, only the Vietnam War's draft lottery appears to be a .hi[*valid* instrument].

---
layout: false
class: clear, middle

If we have a *valid* instrument (_e.g._, the draft lottery), how do we use it?
---
layout: true
# Instrumental variables
## Estimation
---
name: iv_estimation

*Recall:* We want to estimate the effect of veteran status on earnings.
$$
`\begin{align}
  \color{#FFA500}{\text{Earnings}_i} = \beta_0 + \beta_1 \color{#6A5ACD}{\text{Veteran}_i} + u_i
\end{align}`
$$

--

Let's consider two related effects:

--

1. The effect of the .hi-pink[instrument] on the .hi-purple[endogenous variable], _e.g._,
$$
`\begin{align}
  \color{#6A5ACD}{\text{Veteran}_i} = \gamma_0 + \gamma_1 \color{#e64173}{\text{Draft}_i} + v_i
\end{align}`
$$

--
1. The effect of the .hi-pink[instrument] on the .hi-orange[outcome variable], _e.g._,
$$
`\begin{align}
  \color{#FFA500}{\text{Earnings}_i} = \pi_0 + \pi_1 \color{#e64173}{\text{Draft}_i} + w_i
\end{align}`
$$
---

*Recall:* We want to estimate the effect of veteran status on earnings.
$$
`\begin{align}
  \color{#FFA500}{\text{Earnings}_i} = \beta_0 + \beta_1 \color{#6A5ACD}{\text{Veteran}_i} + u_i
\end{align}`
$$
and we know that the draft affected veteran status.

--

.center[
.hi-pink[Draft] ⟶ .hi-purple[Veteran status] ⟶ .hi-orange[Earnings]
]

Using our assumptions on independence and exogeneity:

(Effect of .hi-pink[the draft] on .hi-orange[earnings]) =
&lt;br&gt;  (Effect of .hi-pink[the draft] on .hi-purple[veteran status])×
&lt;br&gt;  (Effect of .hi-purple[veteran status] on .hi-orange[earnings])
---

We just wrote out an expression for the effect of .hi-pink[the draft] on .hi-orange[earnings], _i.e._,

(Effect of .hi-pink[the draft] on .hi-orange[earnings]) =
&lt;br&gt;  (Effect of .hi-pink[the draft] on .hi-purple[veteran status])×
&lt;br&gt;  (Effect of .hi-purple[veteran status] on .hi-orange[earnings])

--

but we want to know the effect of .hi-purple[veteran status] on .hi-orange[earnings].
--
 Rearrange!

--

(Effect of .hi-purple[veteran status] on .hi-orange[earnings]) =
&lt;br&gt;  .top[(Effect of .hi-pink[the draft] on .hi-orange[earnings])]
&lt;br&gt;  .bottom[(Effect of .hi-pink[the draft] on .hi-purple[veteran status])]

--

Our .hi-pink[instrument] consistently estimates both parts of this fraction!
---
layout: true
# Instrumental variables
## Estimation: Bring it all together
---

By estimating two regressions involving our .hi-pink[instrument],

1. The effect of the .hi-pink[instrument] on the .hi-purple[endogenous variable], _e.g._,
$$
`\begin{align}
  \color{#6A5ACD}{\text{Veteran}_i} = \gamma_0 + \gamma_1 \color{#e64173}{\text{Draft}_i} + v_i
\end{align}`
$$

1. The effect of the .hi-pink[instrument] on the .hi-orange[outcome variable], _e.g._,
$$
`\begin{align}
  \color{#FFA500}{\text{Earnings}_i} = \pi_0 + \pi_1 \color{#e64173}{\text{Draft}_i} + w_i
\end{align}`
$$

--

we can estimate our desired effect:

--

(Effect of .hi-purple[veteran status] on .hi-orange[earnings]) =
&lt;br&gt;  .top[(Effect of .hi-pink[the draft] on .hi-orange[earnings])]
&lt;br&gt;  .bottom[(Effect of .hi-pink[the draft] on .hi-purple[veteran status])]

---
count: false

By estimating two regressions involving our .hi-pink[instrument],

1. The effect of the .hi-pink[instrument] on the .hi-purple[endogenous variable], _e.g._,
$$
`\begin{align}
  \color{#6A5ACD}{\text{Veteran}_i} = \gamma_0 + \gamma_1 \color{#e64173}{\text{Draft}_i} + v_i
\end{align}`
$$

1. The effect of the .hi-pink[instrument] on the .hi-orange[outcome variable], _e.g._,
$$
`\begin{align}
  \color{#FFA500}{\text{Earnings}_i} = \pi_0 + \pi_1 \color{#e64173}{\text{Draft}_i} + w_i
\end{align}`
$$

we can estimate our desired effect:

(Effect of .hi-purple[veteran status] on .hi-orange[earnings]) = `\(\dfrac{\pi_1}{\gamma_1}\)`
---
layout: false
class: clear, middle

Let's work an example in .mono[R].
---
layout: true
# Instrumental variables
## Example in .mono[R]
---
name: r_example

Back to our age-old battle to estimate the returns to education.


```
#&gt; # A tibble: 722 x 4
#&gt;     wage  educ educ_dad educ_mom
#&gt;    &lt;int&gt; &lt;int&gt;    &lt;int&gt;    &lt;int&gt;
#&gt;  1   769    12        8        8
#&gt;  2   808    18       14       14
#&gt;  3   825    14       14       14
#&gt;  4   650    12       12       12
#&gt;  5   562    11       11        6
#&gt;  6   600    10        8        8
#&gt;  7  1154    15        5       14
#&gt;  8  1000    12       11       12
#&gt;  9   930    18       14       13
#&gt; 10   900    15       12       12
#&gt; # … with 712 more rows
```
---

OLS for the returns to education is likely (definitely) biased...


```
#&gt; # A tibble: 2 x 5
#&gt;   term        estimate std.error statistic  p.value
#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 (Intercept)    177.      89.2       1.98 4.81e- 2
#&gt; 2 educ            58.6      6.44      9.10 8.76e-19
```

but what if father's or mother's education provide a valid instrument?

--

**Q:** Why/why not?
---
layout: false
class: clear, middle

.mono[Live coding here.]

---
layout: false
# Table of contents

.pull-left[
### Admin
.smallest[

1. [Schedule](#schedule)
1. [Masters program](#masters)
1. [Causality review](#causality_review)
]
]

.pull-right[
### Instrumental variables
.smallest[

1. [Introduction](#intro)
1. [What is an instrument?](#instruments)
  - [Relevant](#relevant)
  - [Exogenous](#exogenous)
1. [IV Estimation](#iv_estimation)
1. [.mono[R] example](#r_example)
]
]
---
exclude: true
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
